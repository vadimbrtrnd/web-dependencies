(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Traffic = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),HtmlComponents=require("./htmlcomponents"),GVControls=function t(e){_classCallCheck(this,t);var a=$("<div/>").attr("role","group").addClass("btn-group-vertical hide");this.aggregationControl=new AggregationControl(a),this.timeControl=new TimeControl(a),$(e).append(a);var n=$(e).parent(),i=$("<div/>").addClass("mapboxgl-ctrl-bottom-middle"),r=$("<div/>").attr("role","group").addClass("btn-group-vertical hide");this.indicatorControl=new IndicatorControl(r),i.append(r),n.append(i)},AggregationControl=function(t){function e(t){_classCallCheck(this,e);var a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),n=HtmlComponents.createGroupElem({class:"aggregation first"});return a.$fakeButton=HtmlComponents.createFakeButton("Aggregation",{class:"help","data-placement":"bottom","data-original-title":"Aggregation help text"}),n.append(a.$fakeButton),a.$checkboxAgg=HtmlComponents.createCheckbox().on("change",{that:a},e.change),n.append(a.$checkboxAgg),t.append(n),a}return _inherits(e,HtmlComponents),_createClass(e,null,[{key:"change",value:function(t){}}]),e}(),TimeControl=function(t){function e(t){_classCallCheck(this,e);var a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),n=HtmlComponents.createGroupElem({class:"time last"});return a.$fakeButton=HtmlComponents.createFakeButton("Historical traffic",{class:"help","data-placement":"bottom","data-original-title":"Historical traffic help text"}),n.append(a.$fakeButton),a.$checkboxTime=HtmlComponents.createCheckbox().on("change",{that:a},e.change),n.append(a.$checkboxTime),a.$datetimePicker=new DateTimePicker(n),t.append(n),a}return _inherits(e,HtmlComponents),_createClass(e,null,[{key:"change",value:function(t){t.data.that.$datetimePicker.datetimeContainer.toggleClass("invisible")}}]),e}(),DateTimePicker=function(){function t(e){_classCallCheck(this,t),this.minTime=360,this.maxTime=1320,this.chosenDateTime=moment(),this.timeValue=15*Math.round(this.chosenDateTime.minute()/15)+60*this.chosenDateTime.hour();var a="linear-gradient(left, #4286f4, #4286f4 percent%, #c5c5c5 percent%, #c5c5c5);";this.cssBackground="background: "+a+"background: -webkit-"+a+"background: -moz-"+a+"background: -o-"+a;var n=((this.timeValue-this.minTime)/(this.maxTime-this.minTime)*100).toString();this.$datetimeContainer=$("<div/>").attr("id","datetime-container").addClass("invisible"),this.$datetimeContainer.append(this.createDayTimeTextArea()),this.$datetimeContainer.append(this.createDayButtons()),this.$datetimeContainer.append(this.createTimeSlider(n)),this.$datetimeContainer.append(t.createTimeKey()),e.append(this.$datetimeContainer)}return _createClass(t,[{key:"createDayTimeTextArea",value:function(){var t=$("<p/>");return this.$dayInput=$("<span/>").attr("id","day").text(this.chosenDateTime.format("dddd")+", "),t.append(this.$dayInput),this.$timeInput=$("<span/>").attr("id","time").text(moment().hour(this.timeValue/60).minute(this.timeValue%60).format("HH:mm")),t.append(this.$timeInput),t}},{key:"createDayButtons",value:function(){var e=t.createRadioGroup(),a={1:{day:"monday",text:"M"},2:{day:"tuesday",text:"T"},3:{day:"wednesday",text:"W"},4:{day:"thursday",text:"T"},5:{day:"friday",text:"F"},6:{day:"saturday",text:"S"},0:{day:"sunday",text:"S"}};for(var n in a)if(a.hasOwnProperty(n)){var i=a[n];e.append(this.createRadioBtn(n===this.chosenDateTime.day().toString(),i.day,i.text,n))}return e}},{key:"createTimeSlider",value:function(e){return $("<div/>").attr("id","time-slider").attr("style",t.replaceAllOccurences(this.cssBackground,"percent",e)).slider({value:this.timeValue,min:this.minTime,max:this.maxTime,step:15}).on("slide",{that:this},t.updateTime)}},{key:"createRadioBtn",value:function(e,a,n,i){var r="btn btn-secondary",o="input";!0===e&&(r+=" active",o+=" checked");var c=$("<label/>").addClass(r).text(n);return c.append($("<"+o+"/>").attr("type","radio").attr("name","days").attr("id",a).attr("autocomplete","off")).attr("day-num",i).on("click",{that:this},t.updateDay),c}},{key:"datetimeContainer",get:function(){return this.$datetimeContainer}}],[{key:"createRadioGroup",value:function(){return $("<div/>").addClass("btn-group").attr("data-toggle","buttons")}},{key:"createTimeKey",value:function(){var e=["08","12","16","20"],a=$("<div/>"),n=$("<div/>").addClass("flex-container").css({width:"90%",margin:"auto"}),i=$("<div/>").addClass("flex-container").css({width:"90%",margin:"auto"});t.createLines(n);var r=!0,o=!1,c=void 0;try{for(var s,l=e[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var d=s.value;i.append($("<span/>").text(d).addClass("time-key-hour"))}}catch(t){o=!0,c=t}finally{try{!r&&l.return&&l.return()}finally{if(o)throw c}}return a.append(n),a.append(i),a}},{key:"createLines",value:function(e){e.append(t.createSmallLine()),e.append(t.createLargeLine()),e.append(t.createSmallLine()),e.append(t.createLargeLine()),e.append(t.createSmallLine()),e.append(t.createLargeLine()),e.append(t.createSmallLine()),e.append(t.createLargeLine()),e.append(t.createSmallLine().css("flex","none"))}},{key:"createSmallLine",value:function(){return $("<div/>").addClass("time-key-small")}},{key:"createLargeLine",value:function(){return $("<div/>").addClass("time-key-large")}},{key:"updateDay",value:function(t){var e=t.data.that;e.chosenDateTime.day($(this).attr("day-num")),e.$dayInput.text(e.chosenDateTime.format("dddd")+", ")}},{key:"updateTime",value:function(e,a){var n=e.data.that;n.timeValue=a.value,n.chosenDateTime.hour(a.value/60).minute(a.value%60),n.$timeInput.text(n.chosenDateTime.format("HH:mm"));var i=((n.timeValue-n.minTime)/(n.maxTime-n.minTime)*100).toString();$(this).attr("style",t.replaceAllOccurences(n.cssBackground,"percent",i))}},{key:"replaceAllOccurences",value:function(t,e,a){return t.split(e).join(a)}}]),t}(),IndicatorControl=function(t){function e(t){_classCallCheck(this,e);var a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));a.indicators={fluidity:{text:"Fluidity",minText:"Bad",maxText:"Good",helpText:"Fluidity help text"},meanspeed:{text:"Mean Speed",minText:"Slow",maxText:"Fast",helpText:"Mean Speed help text"}};var n=HtmlComponents.createGroupElem({class:"dropup"});a.$fakeButton=HtmlComponents.createTextButton(a.indicators.fluidity.text,{class:"help",indicator:"fluidity","data-placement":"bottom","data-original-title":a.indicators.fluidity.helpText}),n.append(a.$fakeButton);var i=HtmlComponents.createArrowButton();n.append(i);var r=HtmlComponents.createMenu();for(var o in a.indicators)a.indicators.hasOwnProperty(o)&&"fluidity"!==o&&r.append(HtmlComponents.createElem(a.indicators[o].text,{indicator:o}).on("click",{that:a},e.change));return n.append(r),a.$indicatorKey=new IndicatorKey(n,a.indicators.fluidity.minText,a.indicators.fluidity.maxText),t.append(n),a}return _inherits(e,HtmlComponents),_createClass(e,null,[{key:"change",value:function(t){var e=t.data.that,a=e.$fakeButton,n=e.indicators,i=a.attr("indicator"),r=$(this).attr("indicator");a.text(n[r].text),a.attr("indicator",r),a.attr("data-original-title",n[r].helpText),$(this).text(n[i].text),$(this).attr("indicator",i),e.$indicatorKey.change(n[r].minText,n[r].maxText)}}]),e}(),IndicatorKey=function(t){function e(t,a,n){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),r={0:"#a50026",25:"#fdae61",50:"#abd9e9",75:"#4575b4"},o=$("<div/>").attr("id","key-container"),c=HtmlComponents.createGroupElem({});i.$minTextArea=e.createMinMaxTextArea(a),c.append(i.$minTextArea);for(var s in r)r.hasOwnProperty(s)&&c.append(e.createColorBox(r[s]));return i.$maxTextArea=e.createMinMaxTextArea(n),c.append(i.$maxTextArea),o.append(c),t.append(o),i}return _inherits(e,HtmlComponents),_createClass(e,[{key:"change",value:function(t,e){this.$minTextArea.text(t),this.$maxTextArea.text(e)}}],[{key:"createMinMaxTextArea",value:function(t){return $("<span/>").text(t)}},{key:"createColorBox",value:function(t){return $("<div/>").css("background-color",t)}}]),e}();module.exports.GVControls=GVControls;

},{"./htmlcomponents":2}],2:[function(require,module,exports){
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),HtmlComponents=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"createGroupElem",value:function(t){var e=$("<div/>");return e.attr(t),e.attr("role","group").addClass("btn-group"),e}},{key:"createFakeButton",value:function(t,e){var n=$("<button/>");return n.attr(e),n.addClass("btn btn-secondary").text(t),n}},{key:"createTextButton",value:function(e,n){var a=t.createDropdownButton();return a.attr(n),a.addClass("btn btn-secondary").text(e),a}},{key:"createArrowButton",value:function(){return t.createDropdownButton().addClass("btn btn-secondary dropdown-toggle dropdown-toggle-split")}},{key:"createDropdownButton",value:function(){var t=$("<button/>").attr("data-toggle","dropdown").attr("type","button").attr("aria-haspopup","true").attr("aria-expanded","false");return $("<span/>").addClass("sr-only").appendTo(t),t}},{key:"createCheckbox",value:function(){var t=$("<span/>");return t.addClass("input-group-addon"),t.append($('<input type="checkbox"/>')),t}},{key:"createMenu",value:function(){return $("<div/>").addClass("dropdown-menu")}},{key:"createElem",value:function(t,e){var n=$("<a/>").addClass("dropdown-item").text(t);return n.attr(e),n}}]),t}();module.exports=HtmlComponents;

},{}],3:[function(require,module,exports){
"use strict";function _possibleConstructorReturn(o,e){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?o:e}function _inherits(o,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(o,e):o.__proto__=e)}function _classCallCheck(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function o(o,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(o,a.key,a)}}return function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e}}(),south=45.0684,north=45.2814,east=5.8939,west=5.5972,center=[(east+west)/2,(south+north)/2],GVMap=function(){function o(e){var t=e.accessToken,a=void 0===t?"pk.eyJ1IjoidmFkaW1icnRybmQiLCJhIjoiY2ozdHVmNXA3MDAxcTRscnQwbW5jN3BrciJ9.M_D88vRMPylLx2KrRxcaTQ":t,n=e.style,r=void 0===n?"mapbox://styles/vadimbrtrnd/cj5kpt23c1sav2ro9jtiifpcj":n,i=e.container,l=void 0===i?"main-map":i,s=e.geojsonpath,u=void 0===s?"/dist/tomtom.geojson":s;_classCallCheck(this,o),mapboxgl.accessToken=a;var c=new mapboxgl.Map({container:l,style:r,center:center,zoom:11,attributionControl:!1,logoPosition:"bottom-right",pitchWithRotate:!1,dragRotate:!1,touchZoomRotate:!1});this.map=c,this.addERCAboutUs(),this.addERCLogo(),this.nav=new GTLNavigationControl,c.addControl(this.nav,"bottom-left");var p=this;$(document).keyup(function(o){27===o.keyCode&&p.resetViewPort()}),this.mapboxCredits=new mapboxgl.AttributionControl({compact:!0}),c.addControl(this.mapboxCredits,"bottom-right"),c.on("load",function(){p.cleanMapboxCredits(),p.resetViewPort(),window.setInterval(function(){c.getSource("lines").setData(u)},6e4),c.addSource("lines",{type:"geojson",data:u});var e={"line-join":"round","line-cap":"round"},t={"line-color":{property:"Service",type:"interval",stops:[[0,"#a50026"],[.25,"#fdae61"],[.5,"#abd9e9"],[.75,"#4575b4"]]},"line-width":{property:"Road Category",stops:[[{zoom:6,value:0},3],[{zoom:6,value:1},0],[{zoom:7,value:0},3],[{zoom:7,value:2},0],[{zoom:8,value:0},3],[{zoom:8,value:3},0],[{zoom:9,value:0},3],[{zoom:9,value:4},0],[{zoom:11,value:0},3],[{zoom:11,value:5},0],[{zoom:13,value:0},3],[{zoom:13,value:6},0],[{zoom:15,value:0},3]]},"line-offset":1.75};c.addLayer({id:"lines",type:"line",source:"lines",layout:e,paint:Object.assign({},t,{"line-opacity":{property:"Road Category",type:"interval",stops:[[{zoom:6,value:0},1],[{zoom:6,value:1},0],[{zoom:7,value:0},1],[{zoom:7,value:2},0],[{zoom:8,value:0},1],[{zoom:8,value:3},0],[{zoom:9,value:0},1],[{zoom:9,value:4},0],[{zoom:11,value:0},1],[{zoom:11,value:5},0],[{zoom:13,value:0},1],[{zoom:13,value:6},0],[{zoom:15,value:0},1]]}}),filter:["!=","TomTomIds",""]}),c.addLayer({id:"lines-not-clicked",type:"line",source:"lines",layout:e,paint:Object.assign({},t,{"line-opacity":{property:"Road Category",type:"interval",stops:[[{zoom:6,value:0},.25],[{zoom:6,value:1},0],[{zoom:7,value:0},.25],[{zoom:7,value:2},0],[{zoom:8,value:0},.25],[{zoom:8,value:3},0],[{zoom:9,value:0},.25],[{zoom:9,value:4},0],[{zoom:11,value:0},.25],[{zoom:11,value:5},0],[{zoom:13,value:0},.25],[{zoom:13,value:6},0],[{zoom:15,value:0},.25]]}}),filter:["==","TomTomIds",""]});var a=0;c.on("click","lines",function(e){a+=1;var t=new mapboxgl.Popup;t.on("close",function(o){1===a&&(c.setFilter("lines-not-clicked",["==","TomTomIds",""]),c.setFilter("lines",["!=","TomTomIds",""])),a-=1}),o.initializePopUp(t,e).addTo(c),c.setFilter("lines-not-clicked",["!=","TomTomIds",e.features[0].properties.TomTomIds]),console.log(e.features[0].properties),console.log(e.features[0].properties.TomTomIds),c.setFilter("lines",["==","TomTomIds",e.features[0].properties.TomTomIds])}),c.on("mouseenter","lines",function(o){c.getCanvas().style.cursor="pointer"}),c.on("mouseleave","lines",function(){c.getCanvas().style.cursor=""})})}return _createClass(o,[{key:"addERCAboutUs",value:function(){var o=$("<div/>").addClass("mapboxgl-ctrl mapboxgl-ctrl-attrib mapboxgl-compact hovered").css("font-weight","bold");o.append($("<a/>").text("About us").css({"margin-right":"5px"}).attr({"data-toggle":"modal","data-target":"#modalAboutUs"})),$(this.map._controlPositions["bottom-left"]).append(o)}},{key:"addERCLogo",value:function(){var o=$("<div/>").addClass("mapboxgl-ctrl");o.append($('<a href="http://scale-freeback.eu/" target="_blank"/>').addClass("erc-ctrl-logo").attr("aria-label","ERC-sfb logo")),$(this.map._controlPositions["bottom-left"]).append(o)}},{key:"cleanMapboxCredits",value:function(){this.mapboxCredits._container.removeChild(this.mapboxCredits._container.lastChild)}},{key:"resetViewPort",value:function(){this.map.fitBounds([[west,south],[east,north]])}}],[{key:"initializePopUp",value:function(o,e){var t=e.features[0],a="<span>FeatureId: "+t.id+"</span><br/>";for(var n in t.properties)t.properties.hasOwnProperty(n)&&(a+="<span>"+n+": "+t.properties[n]+"</span><br/>");return o.setLngLat(e.lngLat).setHTML(a),o}}]),o}(),GTLNavigationControl=function(o){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,mapboxgl.NavigationControl),_createClass(e,[{key:"onAdd",value:function(o){return this._map=o,this._container=e.createDOMElem("div","mapboxgl-ctrl mapboxgl-ctrl-group hide",o.getContainer()),this._container.addEventListener("contextmenu",this._onContextMenu.bind(this)),this._zoomInButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in hidden-xs","Zoom In",o.zoomIn.bind(o)),this._zoomOutButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out hidden-xs","Zoom Out",o.zoomOut.bind(o)),this._container}}],[{key:"createDOMElem",value:function(o,e,t){var a=window.document.createElement(o);return e&&(a.className=e),t&&t.appendChild(a),a}}]),e}();module.exports=GVMap;

},{}],4:[function(require,module,exports){
"use strict";function _classCallCheck(a,r){if(!(a instanceof r))throw new TypeError("Cannot call a class as a function")}require("./libs");var Traffic=function a(){_classCallCheck(this,a),moment.locale("en"),this.GVMap=require("./map/map");var r=require("./map/controls");this.GVControls=r.GVControls};module.exports=Traffic;

},{"./libs":"/traffic/static/traffic/js/libs.js","./map/controls":1,"./map/map":3}]},{},[4])(4)
});